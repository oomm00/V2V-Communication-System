{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">ðŸ“¡ V2V Dashboard</h2>

<!-- Metrics Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card bg-success text-light p-3 mb-3">
      <h6 class="text-uppercase">Verified Alerts</h6>
      <h2>{{ metrics.verified_alerts or 0 }}</h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-info text-light p-3 mb-3">
      <h6 class="text-uppercase">Active Nodes</h6>
      <h2>{{ metrics.active_nodes or 0 }}</h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-warning text-dark p-3 mb-3">
      <h6 class="text-uppercase">Msg/sec</h6>
      <h2>{{ "%.1f"|format(metrics.messages_per_sec or 0) }}</h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-danger text-light p-3 mb-3">
      <h6 class="text-uppercase">Rejected</h6>
      <h2>{{ metrics.rejected_count or 0 }}</h2>
    </div>
  </div>
</div>

<!-- Alerts Table -->
<h3 class="mt-4">ðŸš¨ Verified Hazard Alerts</h3>
{% if alerts %}
  <div class="table-responsive">
    <table class="table table-dark table-hover mt-3">
      <thead>
        <tr>
          <th>Hazard Type</th>
          <th>Location</th>
          <th>Confidence</th>
          <th>Verified At</th>
          <th>Confirmations</th>
        </tr>
      </thead>
      <tbody>
      {% for alert in alerts %}
        <tr>
          <td><span class="badge bg-warning text-dark">{{ alert.hazard_type|upper }}</span></td>
          <td>({{ "%.4f"|format(alert.latitude) }}, {{ "%.4f"|format(alert.longitude) }})</td>
          <td>{{ "%.1f%%"|format((alert.confidence or 0.8) * 100) }}</td>
          <td>{{ alert.formatted_time or "N/A" }}</td>
          <td>{{ alert.confirmations or 1 }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-info mt-3">
    <p>No verified alerts right now. Start the simulator to generate alerts!</p>
  </div>
{% endif %}

<!-- Auto-refresh script -->
<script>
  // Auto-refresh every 5 seconds
  setTimeout(function() {
    location.reload();
  }, 5000);
</script>
{% endblock %}
